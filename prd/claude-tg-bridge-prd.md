# tgmux - PRD

## ä¸€å¥è¯æè¿°

é€šè¿‡ Telegram Bot + Topic è¿œç¨‹æ§åˆ¶æœ¬åœ° tmux ä¸­çš„å¤šç§ AI ç¼–ç¨‹åŠ©æ‰‹ä¼šè¯ï¼ˆClaude Code / Codex / Gemini / bashï¼‰ï¼ŒGo å®ç°ï¼Œå¯é€‰ Web UIã€‚


## æ ¸å¿ƒæ¶æ„

```
Telegram Message â”€â”€â”                    â”Œâ”€â”€ tmux window @0 â”€â”€ claude code (é¡¹ç›®A)
Telegram Topic A â”€â”€â”¤                    â”œâ”€â”€ tmux window @1 â”€â”€ codex (é¡¹ç›®B)
Telegram Topic B â”€â”€â”¼â”€â”€tgmux(Go,Polling) â”¼â”€â”€ tmux window @2 â”€â”€ gemini-cli (é¡¹ç›®C)
Telegram Topic C â”€â”€â”¤        â”‚           â”œâ”€â”€ tmux window @3 â”€â”€ bash (é¡¹ç›®A)
Telegram Topic D â”€â”€â”˜    Web UI (å¯é€‰)   â””â”€â”€ tmux window @4 â”€â”€ claude code (é¡¹ç›®D)
```

**æ˜ å°„å…³ç³»**: 1 Topicï¼ˆæˆ– 1 å¯¹ 1 ç§èŠï¼‰= 1 tmux window = 1 åç«¯ä¼šè¯ï¼ˆbackend + é¡¹ç›®ç›®å½•ï¼‰

> æ³¨æ„ï¼šç§èŠæ²¡æœ‰ Topic æ¦‚å¿µï¼Œä»…èƒ½ç»‘å®šä¸€ä¸ªä¼šè¯ã€‚å¤šä¼šè¯éœ€ä½¿ç”¨ç¾¤ç»„ Topic æ¨¡å¼ã€‚

## äº¤äº’æµç¨‹

### æ¶ˆæ¯å¤„ç†ï¼ˆç§èŠ / ç¾¤èŠ / Topic ç»Ÿä¸€ï¼‰

```
ç”¨æˆ·å‘é€æ¶ˆæ¯
  â†“
é‰´æƒæ£€æŸ¥ï¼ˆallowed_users ç™½åå•ï¼Œä¸åœ¨ç™½åå•å†…é™é»˜ä¸¢å¼ƒï¼‰
  â†“
æŒ‰ chat_id æˆ– topic_id æŸ¥ç»‘å®š
  â†“
â”Œâ”€ å·²ç»‘å®š â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ£€æŸ¥ tmux çª—å£æ˜¯å¦å­˜æ´»                        â”‚
â”‚  â”œâ”€ å­˜æ´» â†’ è½¬å‘åˆ°ç»‘å®šçš„ tmux çª—å£ï¼Œæ­£å¸¸äº¤äº’    â”‚
â”‚  â””â”€ å·²æ­» â†’ æç¤º"ä¼šè¯å·²æ–­å¼€"ï¼Œè‡ªåŠ¨è§£ç»‘ï¼Œ         â”‚
â”‚           è¿›å…¥æœªç»‘å®šæµç¨‹                        â”‚
â”œâ”€ æœªç»‘å®š â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æç¤ºï¼š"è¯¥ Topic å°šæœªç»‘å®šä¼šè¯"                  â”‚
â”‚  æ£€æŸ¥ tmux ä¸­å·²æœ‰çª—å£                          â”‚
â”‚  â”Œâ”€ æœ‰å·²æœ‰ä¼šè¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚  [claude @ my-project     (@0)]    â”‚      â”‚
â”‚  â”‚  [codex @ other-project   (@1)]    â”‚      â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚      â”‚
â”‚  â”‚  [â• æ–°å»ºä¼šè¯]                      â”‚      â”‚
â”‚  â”‚                                     â”‚      â”‚
â”‚  â”‚  é€‰å·²æœ‰ â†’ ç»‘å®šï¼ˆä¸è‡ªåŠ¨è½¬å‘åŸå§‹æ¶ˆæ¯ï¼‰  â”‚      â”‚
â”‚  â”‚  é€‰æ–°å»º â†’ /new æµç¨‹                 â”‚      â”‚
â”‚  â”œâ”€ æ— å·²æœ‰ä¼šè¯ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚  ç›´æ¥è¿›å…¥ /new æµç¨‹                 â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### `/new` æ–°å»ºä¼šè¯

é‡‡ç”¨ä¸¤æ­¥äº¤äº’ï¼Œé™ä½å•æ¬¡è®¤çŸ¥è´Ÿæ‹…ï¼š

```
è§¦å‘ /new
  â†“
çŠ¶æ€æ ‡è®°ä¸º awaiting_dir
  â†“
ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©é¡¹ç›®ç›®å½•ï¼ˆä¸€æ¡æ¶ˆæ¯ï¼‰
â”Œâ”€ ğŸ“‚ é€‰æ‹©é¡¹ç›®ç›®å½• â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [~/project-a]        (æœ€è¿‘ä½¿ç”¨)    â”‚
â”‚ [~/project-b]        (æ”¶è—)        â”‚
â”‚ [ğŸ“ è¾“å…¥è·¯å¾„...]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â†“ ç”¨æˆ·é€‰æ‹©ç›®å½•ï¼ˆæˆ–è¾“å…¥è·¯å¾„ï¼Œæ­¤æ—¶çŠ¶æ€ä¸º awaiting_path_inputï¼Œ
  â†“ ä¸‹ä¸€æ¡æ–‡æœ¬æ¶ˆæ¯ä½œä¸ºè·¯å¾„ï¼Œä¸è§¦å‘ç»‘å®šæµç¨‹ï¼‰
çŠ¶æ€æ ‡è®°ä¸º awaiting_backend
  â†“
ç¬¬äºŒæ­¥ï¼šé€‰æ‹©åç«¯ï¼ˆç¬¬äºŒæ¡æ¶ˆæ¯ï¼‰
â”Œâ”€ ğŸš€ é€‰æ‹©å¯åŠ¨å‘½ä»¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [claude] [codex] [gemini] [bash]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  â†“ ç”¨æˆ·é€‰æ‹©åç«¯
åˆ›å»º tmux çª—å£ â†’ cd ç›®å½• â†’ å¯åŠ¨å‘½ä»¤ â†’ ç»‘å®š
  â†“
âœ… å·²åˆ›å»º claude ä¼šè¯ @ ~/project-a
```

**çŠ¶æ€æœºå®šä¹‰**ï¼š`idle` â†’ `awaiting_dir` â†’ `awaiting_path_input`ï¼ˆå¯é€‰ï¼‰â†’ `awaiting_backend` â†’ `bound`



## å¯åŠ¨å‘½ä»¤

| åç«¯ | tmux å†…å¯åŠ¨å‘½ä»¤ | æ—¥å¿—è·¯å¾„ | è¾“å‡ºç›‘æ§æ–¹å¼ |
|---|---|---|---|
| `claude` | `claude` | `~/.claude/projects/<path-encoded>/` ç›®å½•ä¸‹æœ€æ–° `.jsonl` æ–‡ä»¶ | JSONL å¢é‡è¯»å–ï¼ˆfsnotify ç›‘å¬ç›®å½•ï¼‰ |
| `codex` | `codex` | `~/.codex/sessions/YYYY/MM/DD/` ç›®å½•ä¸‹æœ€æ–° `rollout-*.jsonl` | JSONL å¢é‡è¯»å–ï¼ˆfsnotify ç›‘å¬ç›®å½•ï¼‰ |
| `gemini` | `gemini` | `~/.gemini/tmp/<hash>/chats/` ç›®å½•ä¸‹æœ€æ–° `.json` æ–‡ä»¶ | JSON å…¨é‡è§£æ + diffï¼ˆé JSONLï¼Œæ¯æ¬¡å…¨é‡é‡å†™ï¼‰ |
| `bash` | ç›´æ¥è¿›å…¥ shell | æ—  | tmux capture-pane è½®è¯¢ |

> **æ—¥å¿—è·¯å¾„è¯´æ˜**ï¼š
> - Claude çš„ `<path-encoded>` æ˜¯é¡¹ç›®ç»å¯¹è·¯å¾„çš„ `/` æ›¿æ¢ä¸º `-`ï¼ˆä¿ç•™å¼€å¤´ `-`ï¼‰ï¼Œå¦‚ `/Users/foo/project` â†’ `-Users-foo-project`
> - Claude session æ–‡ä»¶æœ‰ä¸¤ç§ç»“æ„ï¼šç›´æ¥çš„ `<UUID>.jsonl` å’Œå¸¦å­ç›®å½•çš„ `<UUID>/subagents/agent-*.jsonl`ï¼Œç›‘æ§æ—¶éœ€åŒæ—¶å¤„ç†
> - å¯åŠ¨åç«¯åæ— æ³•é¢„çŸ¥å…·ä½“ session æ–‡ä»¶åï¼ˆUUIDï¼‰ï¼Œéœ€ç›‘å¬æ•´ä¸ªç›®å½•ï¼ŒæŒ‰ mtime å–æœ€æ–°æ–‡ä»¶
> - Codex é™¤äº† `sessions/YYYY/MM/DD/` å¤–ï¼Œè¿˜æœ‰ `archived_sessions/` å­˜æ”¾å½’æ¡£ä¼šè¯å’Œ `history.jsonl` å…¨å±€å†å²
> - Gemini çš„ `logs.json` å’Œ `chats/session-*.json` å‡ä¸ºå®Œæ•´ JSONï¼ˆé JSONLï¼‰ï¼Œä¸èƒ½ç”¨ byte_offset å¢é‡è¯»å–
> - è¿™äº›è·¯å¾„æ˜¯å„å·¥å…·çš„å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œæ— ç¨³å®šæ€§ä¿è¯ï¼Œåº”ä½œä¸ºå¯é…ç½®é¡¹ï¼Œå…è®¸ç”¨æˆ·è¦†ç›–
> - å½“æ—¥å¿—æ–‡ä»¶ç›‘æ§å¤±è´¥æ—¶ï¼Œè‡ªåŠ¨é™çº§åˆ° capture-pane è½®è¯¢

ä¸åŒåç«¯ç»Ÿä¸€é€šè¿‡ tmux send-keys å‘é€è¾“å…¥ã€‚AI å·¥å…·ä¼˜å…ˆä½¿ç”¨æ—¥å¿—æ–‡ä»¶ç›‘æ§ï¼ˆæ›´ç²¾å‡†ï¼‰ï¼Œbash ä½¿ç”¨ capture-pane è½®è¯¢å…œåº•ã€‚

## æŠ€æœ¯é€‰å‹

| ç»„ä»¶ | é€‰æ‹© | ç†ç”± |
|---|---|---|
| è¯­è¨€ | Go | å•äºŒè¿›åˆ¶éƒ¨ç½²ï¼Œå¹¶å‘åŸç”Ÿæ”¯æŒ |
| Telegram SDK | [go-telegram/bot](https://github.com/go-telegram/bot) | Telegram å®˜ç½‘æ¨èï¼Œé›¶ä¾èµ–ï¼Œæ”¯æŒ Bot API 9.4ï¼Œæ´»è·ƒç»´æŠ¤ |
| tmux äº¤äº’ | exec.Command è°ƒç”¨ tmux CLI | ç®€å•å¯é ï¼Œæ— éœ€ cgo |
| ä¼šè¯ç›‘æ§ | fsnotify + æ—¥å¿—æ–‡ä»¶ / capture-pane è½®è¯¢ | AI å·¥å…·ç”¨æ—¥å¿—ç›®å½•ç›‘æ§ï¼ˆæ³¨æ„ï¼šç›‘å¬ç›®å½•è€Œéå•æ–‡ä»¶ï¼Œé¿å… macOS åŸå­ä¿å­˜å¯¼è‡´ç›‘è§†ä¸¢å¤±ï¼‰ï¼Œbash ç”¨ capture-pane |
| Web UI | å†…åµŒ embed.FS + WebSocket | å•äºŒè¿›åˆ¶ï¼Œå¯é€šè¿‡é…ç½®å…³é—­ |
| é…ç½® | YAML å•æ–‡ä»¶ | ~/.tgmux/config.yaml |
| çŠ¶æ€æŒä¹…åŒ– | JSON æ–‡ä»¶ | ~/.tgmux/state.json |

## åŠŸèƒ½æ¸…å•

### P0 - æ ¸å¿ƒï¼ˆMVPï¼‰

**å®‰å…¨**
- å¯åŠ¨æ—¶æ ¡éªŒ `allowed_users` éç©ºï¼Œä¸ºç©ºåˆ™æ‹’ç»å¯åŠ¨
- æ‰€æœ‰æ¶ˆæ¯å¤„ç†å…¥å£åš user_id ç™½åå•æ ¡éªŒï¼Œéç™½åå•é™é»˜ä¸¢å¼ƒ
- é…ç½®æ–‡ä»¶æƒé™æ£€æŸ¥ï¼šå¯åŠ¨æ—¶æ£€æµ‹ config.yaml æƒé™ï¼Œé 600 åˆ™è­¦å‘Š
- æ”¯æŒç¯å¢ƒå˜é‡ `TGMUX_BOT_TOKEN` è¦†ç›–é…ç½®æ–‡ä»¶ä¸­çš„ token
- æ•æ„Ÿä¿¡æ¯è„±æ•ï¼šæ‰€æœ‰æ¨é€åˆ° Telegram çš„å†…å®¹è‡ªåŠ¨è¿‡æ»¤ API keyã€tokenã€å¯†ç ç­‰æ¨¡å¼ï¼ˆæ­£åˆ™åŒ¹é…æ›¿æ¢ä¸º `[REDACTED]`ï¼‰

**ä¼šè¯ç®¡ç†**
- `/new` - åœ¨åˆ›å»ºtopicçš„æ—¶å€™ï¼Œæˆ–è€…å‘é€æ¶ˆæ¯å‘ç°æ²¡æœ‰ç»‘å®šçš„æ—¶å€™ï¼ˆä¸ä¸»åŠ¨å‘ˆç°åœ¨é€‰é¡¹é‡Œå¤´ï¼‰
- `/session` - æ— å‚æ•°æ—¶æŸ¥çœ‹å½“å‰ç»‘å®šä¼šè¯è¯¦æƒ…ï¼›åŠ  `list` å‚æ•°æ—¶åˆ—å‡ºæ‰€æœ‰ tmux çª—å£åŠç»‘å®šçŠ¶æ€
- `/kill` - å…³é—­å½“å‰ç»‘å®šçš„ tmux çª—å£å¹¶è§£ç»‘
 

**`/session` è¾“å‡ºç¤ºä¾‹**
```
ğŸ“‹ å½“å‰ä¼šè¯ä¿¡æ¯
â”œâ”€ çª—å£:    @0
â”œâ”€ åç«¯:    claude
â”œâ”€ ç›®å½•:    ~/project/my-app
â”œâ”€ å‘½ä»¤:    claude
â”œâ”€ çŠ¶æ€:    è¿è¡Œä¸­
â””â”€ åˆ›å»ºäº:  2h30m ago
```

**`/session list` è¾“å‡ºç¤ºä¾‹**
```
ğŸ–¥ æ‰€æœ‰ tmux çª—å£

@0  claude @ my-app        â† å·²ç»‘å®š Topic "åç«¯å¼€å‘"
@1  codex @ api-server     â† å·²ç»‘å®š Topic "APIé‡æ„"
@2  bash @ scripts         â† æœªç»‘å®š [ç‚¹å‡»ç»‘å®š]
@3  gemini @ ml-project    â† æœªç»‘å®š [ç‚¹å‡»ç»‘å®š]
```

**æ¶ˆæ¯äº¤äº’**
- Topic å†…å‘æ–‡æœ¬ â†’ è½¬å‘åˆ°ç»‘å®šçª—å£ï¼ˆå¤šè¡Œæ–‡æœ¬ä½¿ç”¨ `tmux load-buffer` + `paste-buffer` é¿å…æ¢è¡Œè¢«è§£é‡Šä¸º Enterï¼›å•è¡Œä½¿ç”¨ `send-keys -l`ï¼‰
- æ¯ä¸ª tmux window ç»‘å®šä¸€ä¸ªä¸²è¡Œå‘é€ channelï¼Œä¿è¯æ¶ˆæ¯é¡ºåºï¼Œé¿å…å¹¶å‘ send-keys äº¤é”™
- è¾“å‡ºç›‘æ§ â†’ æ ¹æ®åç«¯ç±»å‹è‡ªåŠ¨é€‰æ‹©ï¼šClaude/Codex ç”¨ JSONL å¢é‡ç›‘æ§ï¼ŒGemini ç”¨ JSON å…¨é‡ diffï¼Œbash ç”¨ capture-pane
- é•¿æ¶ˆæ¯è‡ªåŠ¨åˆ†å‰²ï¼ˆTelegram 4096 å­—ç¬¦é™åˆ¶ï¼‰ï¼Œåˆ†å‰²ç‚¹åœ¨ä»£ç å—è¾¹ç•Œå¤„åˆ‡å‰²ï¼Œä¿è¯æ¯æ¡æ¶ˆæ¯ Markdown å®Œæ•´æ€§
- Markdown æ¸²æŸ“å¤±è´¥è‡ªåŠ¨é™çº§çº¯æ–‡æœ¬
- æµå¼æ¨é€ï¼šä½¿ç”¨ editMessage èŠ‚æµï¼ˆç¾¤ç»„åœºæ™¯ 3000msï¼Œç§èŠåœºæ™¯ 1000msï¼‰ï¼Œè¶…è¿‡ 3800 å­—ç¬¦å®šç¨¿å½“å‰æ¶ˆæ¯å‘æ–°æ¶ˆæ¯ç»§ç»­ï¼Œå®ç° 429 æŒ‡æ•°é€€é¿é‡è¯•

> **å…³äº sendMessageDraft**ï¼šBot API 9.3 å¼•å…¥çš„ `sendMessageDraft` ä»…æ”¯æŒç§èŠï¼Œä¸æ”¯æŒç¾¤ç»„ Topicã€‚ç”±äºæ ¸å¿ƒåœºæ™¯æ˜¯ç¾¤ç»„ Topicï¼Œç»Ÿä¸€ä½¿ç”¨ editMessage èŠ‚æµæ–¹æ¡ˆã€‚å¦‚æœªæ¥ API æ”¯æŒç¾¤ç»„ï¼Œå¯ä½œä¸ºå¢å¼ºé¡¹å¼•å…¥ã€‚

**æ§åˆ¶å‘½ä»¤**
- `/esc` - å‘é€ Escape é”®ï¼ˆä¸­æ–­ Claudeï¼‰
- `/enter` - å‘é€å›è½¦é”®
- æƒé™ç¡®è®¤ï¼šæ£€æµ‹åˆ° AI å·¥å…·ç­‰å¾…ç¡®è®¤æ—¶ï¼Œè‡ªåŠ¨æ¨é€å†…è”é”®ç›˜ [Yes] [No] [Always]ï¼ˆæ›¿ä»£æ‰‹åŠ¨è¾“å…¥ /y /nï¼‰
- `/screenshot` - æ•è· tmux çª—å£å†…å®¹ï¼Œæ¸²æŸ“ä¸ºå›¾ç‰‡å‘é€ï¼ˆä¾èµ– `aha` + `wkhtmltoimage` æˆ–å†…ç½® ANSIâ†’å›¾ç‰‡æ¸²æŸ“ï¼‰
- `/cmd` {arg} - åŸç”ŸæŒ‡ä»¤é€ä¼ ï¼Œè‡ªåŠ¨æ ¹æ®å½“å‰ç»‘å®šçš„åç«¯ç±»å‹è·¯ç”±ï¼ˆå¦‚ claude çš„ /configã€codex çš„ /model ç­‰ï¼‰


**çŠ¶æ€æŒä¹…åŒ–**
- Topic â†” tmux window ç»‘å®šå…³ç³»ï¼ˆå«åç«¯ç±»å‹ï¼‰
- å„ Topic çš„å·²è¯»åç§»é‡ï¼ˆJSONL ç”¨ byte_offsetï¼ŒGemini JSON ç”¨ message countï¼‰
- å¸¸ç”¨ç›®å½•åˆ—è¡¨ï¼ˆæ”¶è— + æœ€è¿‘ä½¿ç”¨ï¼‰
- é‡å¯åè‡ªåŠ¨æ¢å¤ç»‘å®šï¼Œæ¢å¤æ—¶éªŒè¯ï¼š(1) tmux session æ˜¯å¦å­˜åœ¨ (2) å¯¹åº” window æ˜¯å¦å­˜åœ¨ (3) çª—å£å†…è¿›ç¨‹æ˜¯å¦å­˜æ´»ã€‚æ­»ç»‘å®šæ ‡è®°ä¸º "å·²æ–­å¼€" ä¾›ç”¨æˆ·é€‰æ‹©é‡å¯æˆ–è§£ç»‘
- å†…å­˜ä¸­ç»´æŠ¤çŠ¶æ€ + `sync.RWMutex` ä¿æŠ¤å¹¶å‘è®¿é—®ï¼Œå˜æ›´æ—¶å¼‚æ­¥åˆ·ç›˜åˆ° state.json

**å¸¸ç”¨ç›®å½•ç®¡ç†**
- æ‰‹åŠ¨æ”¶è—ï¼š`/dir add <è·¯å¾„>` æ·»åŠ æ”¶è—ï¼Œ`/dir rm <è·¯å¾„>` ç§»é™¤
- `/dir` æ— å‚æ•°æ—¶åˆ—å‡ºæ‰€æœ‰æ”¶è— + æœ€è¿‘ä½¿ç”¨ï¼›åŠ  `browse` å‚æ•°æ—¶ä» `~` ç›®å½•é€å±‚æµè§ˆï¼Œå‘ˆç°ï¼šã€è¿›å…¥ï¼Œæ·»åŠ æ”¶è—ã€‘

### P1 - å¢å¼º

**Web UIï¼ˆå¯å…³é—­ï¼‰**
- é…ç½®é¡¹ `web.enabled: false` é»˜è®¤å…³é—­
- å¼ºåˆ¶ç»‘å®š `127.0.0.1`ï¼Œå¯åŠ¨æ—¶ç”Ÿæˆéšæœº access token æ‰“å°åˆ°ç»ˆç«¯
- WebSocket æ ¡éªŒ Originï¼Œé˜²æ­¢è·¨ç«™åŠ«æŒ
- å¼€å¯åç›‘å¬æœ¬åœ°ç«¯å£ï¼Œæä¾›ï¼š
  - ä¼šè¯åˆ—è¡¨å’ŒçŠ¶æ€æ€»è§ˆ
  - å®æ—¶ç»ˆç«¯è¾“å‡ºï¼ˆWebSocketï¼‰
  - åŸºç¡€æ“ä½œï¼ˆå‘æ¶ˆæ¯ã€ä¸­æ–­ã€åˆ‡æ¢ï¼‰
  - è¶…é•¿è¾“å‡ºçš„å®Œæ•´æŸ¥çœ‹ï¼ˆTelegram æ¶ˆæ¯ä¸­å¯é™„å¸¦ "æŸ¥çœ‹å®Œæ•´è¾“å‡º" é“¾æ¥ï¼‰
- å‰ç«¯ç”¨çº¯ HTML + vanilla JSï¼Œembed è¿›äºŒè¿›åˆ¶
- ä¸åš Mini Appï¼Œä»…ä½œä¸ºæœ¬åœ°è¾…åŠ©é¢æ¿

**æ–‡ä»¶äº¤äº’**
- å‘é€å›¾ç‰‡ â†’ ä¿å­˜åˆ°é¡¹ç›®ä¸´æ—¶ç›®å½•ï¼Œè·¯å¾„ä¼ ç»™ Claude
- å‘é€æ–‡ä»¶ â†’ åŒä¸Š

**è¶…é•¿è¾“å‡ºå¢å¼º**
- è¶…é•¿è¾“å‡ºè‡ªåŠ¨æ¸²æŸ“ä¸ºå›¾ç‰‡å‘é€ï¼ˆå¤ç”¨ /screenshot çš„æ¸²æŸ“èƒ½åŠ›ï¼‰
- æˆ–å‘é€æ‘˜è¦ + "æŸ¥çœ‹å®Œæ•´è¾“å‡º" æŒ‰é’®è·³è½¬ Web UIï¼ˆéœ€ Web UI å¼€å¯ï¼‰

## å‘½ä»¤é€ŸæŸ¥è¡¨

| å‘½ä»¤ | è¯´æ˜ | åœºæ™¯ |
|---|---|---|
| `/new` | æ–°å»ºä¼šè¯ï¼ˆä¸¤æ­¥ï¼šé€‰ç›®å½•â†’é€‰åç«¯ï¼‰ | æœªç»‘å®šæ—¶è‡ªåŠ¨è§¦å‘ï¼Œä¸ä¸»åŠ¨å‘ˆç°åœ¨èœå• |
| `/session` | æŸ¥çœ‹å½“å‰ç»‘å®šä¼šè¯è¯¦æƒ…ï¼ˆçª—å£ã€ç›®å½•ã€åç«¯ã€å‘½ä»¤ã€æ—¶é•¿ï¼‰ | ä»»æ„æ—¶åˆ» |
| `/session list` | åˆ—å‡ºæ‰€æœ‰ tmux çª—å£ï¼Œæœªç»‘å®šçš„å¯ç‚¹å‡»ç»‘å®šï¼Œä¹Ÿå¯ç‚¹å‡»å…³é—­ | ä»»æ„æ—¶åˆ» |
| `/kill` | å…³é—­å½“å‰ç»‘å®šçš„ tmux çª—å£å¹¶è§£ç»‘ | å·²ç»‘å®šæ—¶å¯ç”¨ |
| `/esc` | å‘é€ Escape é”®ï¼Œä¸­æ–­å½“å‰åç«¯ | å·²ç»‘å®šæ—¶å¯ç”¨ |
| `/enter` | å‘é€å›è½¦é”® | å·²ç»‘å®šæ—¶å¯ç”¨ |
| `/screenshot` | æˆªå›¾ tmux çª—å£ï¼Œæ¸²æŸ“ä¸ºå›¾ç‰‡å‘é€ | å·²ç»‘å®šæ—¶å¯ç”¨ |
| `/cmd` {arg} | åç«¯åŸç”ŸæŒ‡ä»¤é€ä¼ ï¼Œè‡ªåŠ¨è·¯ç”±åˆ°å½“å‰ç»‘å®šçš„åç«¯ç±»å‹ | å·²ç»‘å®šæ—¶å¯ç”¨ |
| `/dir` | åˆ—å‡ºæ”¶è— + æœ€è¿‘ä½¿ç”¨ç›®å½• | ä»»æ„æ—¶åˆ» |
| `/dir browse` | ä» ~ ç›®å½•é€å±‚æµè§ˆï¼Œå¯ã€è¿›å…¥ã€‘æˆ–ã€æ·»åŠ æ”¶è—ã€‘ | ä»»æ„æ—¶åˆ» |
| `/dir add <è·¯å¾„>` | æ·»åŠ ç›®å½•åˆ°æ”¶è— | ä»»æ„æ—¶åˆ» |
| `/dir rm <è·¯å¾„>` | ä»æ”¶è—ä¸­ç§»é™¤ç›®å½• | ä»»æ„æ—¶åˆ» |

> æƒé™ç¡®è®¤ï¼ˆy/n/alwaysï¼‰é€šè¿‡å†…è”é”®ç›˜æŒ‰é’®è‡ªåŠ¨æ¨é€ï¼Œæ— éœ€æ‰‹åŠ¨å‘½ä»¤ã€‚

## é¡¹ç›®ç»“æ„

```
tgmux/
â”œâ”€â”€ main.go                 # å…¥å£ï¼ŒCLI å‚æ•°è§£æï¼Œå¯åŠ¨ bot + webï¼Œgraceful shutdown
â”œâ”€â”€ config/
â”‚   â””â”€â”€ config.go           # YAML é…ç½®åŠ è½½ + CLI flag åˆå¹¶ + ç¯å¢ƒå˜é‡è¦†ç›–
â”œâ”€â”€ auth/
â”‚   â””â”€â”€ auth.go             # ç”¨æˆ·ç™½åå•æ ¡éªŒä¸­é—´ä»¶
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ backend.go          # Backend æ¥å£å®šä¹‰ï¼ˆå¯åŠ¨å‘½ä»¤ã€æ—¥å¿—è·¯å¾„æ¨¡å¼ç­‰å…ƒæ•°æ®ï¼Œä¸å«ç›‘æ§é€»è¾‘ï¼‰
â”‚   â”œâ”€â”€ claude.go           # Claude Codeï¼šå¯åŠ¨å‘½ä»¤ + æ—¥å¿—è·¯å¾„è§„åˆ™
â”‚   â”œâ”€â”€ codex.go            # Codexï¼šå¯åŠ¨å‘½ä»¤ + æ—¥å¿—è·¯å¾„è§„åˆ™
â”‚   â”œâ”€â”€ gemini.go           # Geminiï¼šå¯åŠ¨å‘½ä»¤ + æ—¥å¿—è·¯å¾„è§„åˆ™
â”‚   â””â”€â”€ bash.go             # Bashï¼šç›´æ¥ shell
â”œâ”€â”€ bot/
â”‚   â”œâ”€â”€ bot.go              # Telegram bot åˆå§‹åŒ–ã€pollingã€graceful shutdown
â”‚   â”œâ”€â”€ handlers.go         # å‘½ä»¤å¤„ç†å™¨ + çŠ¶æ€æœºï¼ˆawaiting_dir/awaiting_backend ç­‰ï¼‰
â”‚   â””â”€â”€ keyboard.go         # å†…è”é”®ç›˜æ„å»ºï¼ˆåç«¯é€‰æ‹©ã€ç›®å½•é€‰æ‹©ã€æƒé™ç¡®è®¤æŒ‰é’®ï¼‰
â”œâ”€â”€ tmux/
â”‚   â”œâ”€â”€ manager.go          # tmux çª—å£åˆ›å»º/é”€æ¯/send-keys/load-buffer+paste-buffer
â”‚   â””â”€â”€ capture.go          # capture-pane + æˆªå›¾æ¸²æŸ“ï¼ˆANSIâ†’å›¾ç‰‡ï¼‰
â”œâ”€â”€ monitor/
â”‚   â”œâ”€â”€ jsonl.go            # fsnotify ç›‘å¬ç›®å½• + JSONL å¢é‡è¯»å–ï¼ˆClaude / Codexï¼‰
â”‚   â”œâ”€â”€ json_diff.go        # fsnotify ç›‘å¬ç›®å½• + JSON å…¨é‡ diffï¼ˆGemini ä¸“ç”¨ï¼‰
â”‚   â”œâ”€â”€ pane.go             # capture-pane è½®è¯¢ï¼ˆbash + é™çº§å…œåº•ï¼‰
â”‚   â””â”€â”€ dispatcher.go       # æ ¹æ®åç«¯ç±»å‹åˆ†å‘åˆ°å¯¹åº”ç›‘æ§å™¨
â”œâ”€â”€ sanitize/
â”‚   â””â”€â”€ redact.go           # æ•æ„Ÿä¿¡æ¯è„±æ•è¿‡æ»¤å™¨ï¼ˆAPI keyã€tokenã€å¯†ç ç­‰ï¼‰
â”œâ”€â”€ state/
â”‚   â””â”€â”€ store.go            # ç»‘å®šå…³ç³» + åç§»é‡ + å¸¸ç”¨ç›®å½•æŒä¹…åŒ–ï¼ˆsync.RWMutex + å¼‚æ­¥åˆ·ç›˜ï¼‰
â”œâ”€â”€ web/                    # å¯é€‰ Web UI
â”‚   â”œâ”€â”€ server.go           # HTTP + WebSocket æœåŠ¡ï¼ˆ127.0.0.1 ç»‘å®š + token é‰´æƒ + Origin æ ¡éªŒï¼‰
â”‚   â””â”€â”€ static/             # embed.FS é™æ€èµ„æº
â”‚       â”œâ”€â”€ index.html
â”‚       â””â”€â”€ app.js
â”œâ”€â”€ config.example.yaml
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ Makefile
â””â”€â”€ README.md
```

## é…ç½®æ–‡ä»¶

```yaml
# ~/.tgmux/config.yaml
telegram:
  token: "your-bot-token"       # æˆ–é€šè¿‡ç¯å¢ƒå˜é‡ TGMUX_BOT_TOKEN è¦†ç›–
  allowed_users:                 # å¿…å¡«ï¼Œä¸ºç©ºåˆ™æ‹’ç»å¯åŠ¨
    - 123456789

backends:
  claude:
    command: "claude"            # å¯åŠ¨å‘½ä»¤ï¼Œå¯è‡ªå®šä¹‰å‚æ•°
    args: []                     # å¦‚éœ€ ["--dangerously-skip-permissions"] è¯·è‡ªè¡Œé…ç½®ï¼ˆæ³¨æ„å®‰å…¨é£é™©ï¼‰
    log_dir_pattern: "~/.claude/projects/{path_encoded}/"  # å¯è¦†ç›–
  codex:
    command: "codex"
    args: []
    log_dir_pattern: "~/.codex/sessions/{date}/"
  gemini:
    command: "gemini"
    args: []
    log_dir_pattern: "~/.gemini/tmp/{hash}/chats/"
  bash:
    command: ""                  # ç©ºåˆ™ç›´æ¥ä½¿ç”¨é»˜è®¤ shell
    enabled: true                # å¯è®¾ä¸º false ç¦ç”¨ bash åç«¯

dirs:
  favorites: []                  # æ‰‹åŠ¨æ”¶è—çš„ç›®å½•ï¼Œä¹Ÿå¯é€šè¿‡ /dir add ç®¡ç†
  recent_max: 10                 # æœ€è¿‘ä½¿ç”¨ç›®å½•æœ€å¤§è®°å½•æ•°

security:
  redact_secrets: true           # è‡ªåŠ¨è„±æ•æ¨é€åˆ° Telegram çš„å†…å®¹
  config_permission_check: true  # å¯åŠ¨æ—¶æ£€æŸ¥ config.yaml æƒé™æ˜¯å¦ä¸º 600

web:
  enabled: false
  port: 3030
  bind: "127.0.0.1"             # å¼ºåˆ¶æœ¬åœ°ç»‘å®š

monitor:
  poll_interval: 500ms           # capture-pane è½®è¯¢é—´éš”
  group_throttle: 3000ms         # ç¾¤ç»„æ¶ˆæ¯ç¼–è¾‘èŠ‚æµï¼ˆTelegram é™åˆ¶ï¼šç¾¤ç»„æ¯åˆ†é’Ÿ 20 æ¡ï¼‰
  private_throttle: 1000ms       # ç§èŠæ¶ˆæ¯ç¼–è¾‘èŠ‚æµï¼ˆTelegram é™åˆ¶ï¼šæ¯ç§’çº¦ 1 æ¡ï¼‰
```

## çŠ¶æ€æ–‡ä»¶

```json
{
  "bindings": {
    "topic_123": {
      "window_id": "@0",
      "backend": "claude",
      "project_path": "/home/user/my-project",
      "display_name": "claude @ my-project",
      "created_at": "2026-02-12T10:00:00Z",
      "status": "running"
    },
    "topic_456": {
      "window_id": "@1",
      "backend": "codex",
      "project_path": "/home/user/other-project",
      "display_name": "codex @ other-project",
      "created_at": "2026-02-12T11:00:00Z",
      "status": "running"
    }
  },
  "offsets": {
    "topic_123": {
      "file": "/path/to/session.jsonl",
      "byte_offset": 4096
    },
    "topic_456_gemini": {
      "file": "/path/to/session.json",
      "message_count": 12
    }
  },
  "dirs": {
    "favorites": ["/home/user/my-project", "/home/user/work"],
    "recent": ["/home/user/other-project", "/home/user/my-project"]
  }
}
```

## å…³é”®å®ç°è¦ç‚¹

**tmux äº¤äº’**
```
åˆ›å»ºçª—å£:  tmux new-window -t {session_name} -n "claude-my-project"
è¿›å…¥ç›®å½•:  tmux send-keys -t {session_name}:@0 "cd /path/to/project" Enter
å¯åŠ¨åç«¯:  tmux send-keys -t {session_name}:@0 "claude" Enter
å‘é€å•è¡Œ:  tmux send-keys -t {session_name}:@0 -l "user message"
å‘é€å¤šè¡Œ:  tmux load-buffer - <<< "multi\nline\ntext" && tmux paste-buffer -t {session_name}:@0
å‘é€å›è½¦:  tmux send-keys -t {session_name}:@0 Enter
å‘é€ESC:   tmux send-keys -t {session_name}:@0 Escape
æ•è·å†…å®¹:  tmux capture-pane -t {session_name}:@0 -p -e
æ£€æŸ¥å­˜æ´»:  tmux list-windows -t {session_name} -F "#{window_id}"
```

> **æ³¨æ„äº‹é¡¹**ï¼š
> - `send-keys -l` çš„æ¢è¡Œç¬¦ `\n` ä¼šè¢«è§£é‡Šä¸º Enterï¼Œå¤šè¡Œæ–‡æœ¬å¿…é¡»ç”¨ `load-buffer` + `paste-buffer`
> - tmux å‘½ä»¤ç¼“å†²åŒºçº¦ 2KBï¼Œè¶…é•¿æ¶ˆæ¯éœ€åˆ†ç‰‡æˆ–ç”¨ buffer æ–¹æ¡ˆ
> - å¿…é¡»ä½¿ç”¨ `exec.Command("tmux", ...)` æ•°ç»„å½¢å¼è°ƒç”¨ï¼Œç¦æ­¢ shell å­—ç¬¦ä¸²æ‹¼æ¥ï¼ˆé˜²å‘½ä»¤æ³¨å…¥ï¼‰
> - æ¯ä¸ª tmux window ç»‘å®šä¸€ä¸ªä¸²è¡Œå‘é€ goroutineï¼ˆchannelï¼‰ï¼Œä¿è¯æ¶ˆæ¯é¡ºåº

**è¾“å‡ºç›‘æ§ï¼ˆåŒç­–ç•¥ï¼‰**

ç­–ç•¥ä¸€ï¼šæ—¥å¿—æ–‡ä»¶ç›‘æ§ï¼ˆClaude / Codex / Geminiï¼‰

**Claude / Codexï¼ˆJSONL å¢é‡è¯»å–ï¼‰**ï¼š
1. fsnotify ç›‘å¬å¯¹åº”æ—¥å¿—**ç›®å½•**ï¼ˆéå•æ–‡ä»¶ï¼Œé¿å… macOS åŸå­ä¿å­˜å¯¼è‡´ç›‘è§†ä¸¢å¤±ï¼‰
   - Claude: `~/.claude/projects/<path-encoded>/` â€” æ£€æµ‹æœ€æ–° `.jsonl` æ–‡ä»¶
   - Codex: `~/.codex/sessions/YYYY/MM/DD/` â€” æ£€æµ‹æœ€æ–° `rollout-*.jsonl` æ–‡ä»¶
2. æ–°æ–‡ä»¶åˆ›å»ºæ—¶è‡ªåŠ¨åˆ‡æ¢ç›‘æ§ç›®æ ‡ï¼ˆæŒ‰ mtime å–æœ€æ–°ï¼‰
3. æ–‡ä»¶å˜åŒ–æ—¶ï¼Œä»ä¸Šæ¬¡ byte_offset å¼€å§‹å¢é‡è¯»å–
4. é€è¡Œè§£æ JSONï¼Œæå– assistant æ¶ˆæ¯ã€tool_use ç­‰
5. ç»æ•æ„Ÿä¿¡æ¯è„±æ•åï¼Œæ ¼å¼åŒ–æ¨é€åˆ°å¯¹åº” Topic
6. æ›´æ–° byte_offset

**Geminiï¼ˆJSON å…¨é‡ diffï¼‰**ï¼š

Gemini CLI æœ‰ä¸¤ä¸ªå¯ç›‘æ§æ–‡ä»¶ï¼ˆå‡ä¸º JSONï¼Œé JSONLï¼Œå…¨é‡é‡å†™ï¼‰ï¼š
- `logs.json`ï¼šJSON æ•°ç»„ï¼Œç»“æ„ç®€å•ï¼ˆsessionId, messageId, type, message, timestampï¼‰ï¼Œæ¨èä¼˜å…ˆä½¿ç”¨
- `chats/session-*.json`ï¼šå®Œæ•´ JSON å¯¹è±¡ï¼Œå« messages æ•°ç»„ã€thoughtsã€tokensã€toolCallsï¼Œä¿¡æ¯æ›´ä¸°å¯Œä½†æ–‡ä»¶æ›´å¤§

> ç¤¾åŒºæœ‰æè®®ç»™ Gemini CLI åŠ  JSONL è‡ªåŠ¨æ—¥å¿—åŠŸèƒ½ï¼Œä½†ç›®å‰æœªå®ç°ã€‚å¦‚æœªæ¥æ”¯æŒï¼Œå¯åˆ‡æ¢åˆ° JSONL å¢é‡è¯»å–ã€‚

ç›‘æ§æµç¨‹ï¼ˆä¼˜å…ˆä½¿ç”¨ `logs.json`ï¼‰ï¼š
1. fsnotify ç›‘å¬ `~/.gemini/tmp/<hash>/` ç›®å½•
2. `logs.json` å˜åŒ–æ—¶ï¼Œè§£ææ•´ä¸ª JSON æ•°ç»„
3. ä¸ä¸Šæ¬¡è§£æç»“æœæŒ‰ messageId å¯¹æ¯”ï¼Œæå–æ–°å¢æ¡ç›®
4. æ³¨æ„ï¼šæ–‡ä»¶å¯èƒ½å¤„äºå†™å…¥ä¸­é—´çŠ¶æ€ï¼ˆtruncate + write éåŸå­ï¼‰ï¼Œè§£æå¤±è´¥æ—¶è·³è¿‡ç­‰å¾…ä¸‹æ¬¡äº‹ä»¶
5. ç»è„±æ•åæ¨é€åˆ°å¯¹åº” Topic
6. æ›´æ–° last_message_id

**é™çº§ç­–ç•¥**ï¼šå½“æ—¥å¿—æ–‡ä»¶ç›‘æ§å¤±è´¥ï¼ˆè·¯å¾„å˜æ›´ã€æ ¼å¼ä¸å…¼å®¹ç­‰ï¼‰æ—¶ï¼Œè‡ªåŠ¨é™çº§åˆ° capture-pane è½®è¯¢

ç­–ç•¥äºŒï¼šcapture-pane è½®è¯¢ï¼ˆbashï¼‰
1. å®šæ—¶æ‰§è¡Œ `tmux capture-pane -p -e` è·å–çª—å£å†…å®¹
2. ä¸ä¸Šæ¬¡å¿«ç…§ diffï¼Œæå–æ–°å¢è¡Œ
3. è¿‡æ»¤ ANSI è½¬ä¹‰åºåˆ—ï¼Œæ ¼å¼åŒ–åæ¨é€åˆ°å¯¹åº” Topic
4. æ›´æ–°å¿«ç…§

**æµå¼æ¨é€ç­–ç•¥ï¼ˆeditMessage èŠ‚æµï¼‰**

- æ–°å†…å®¹åˆ°è¾¾ â†’ è¿½åŠ åˆ° buffer
- æ ¹æ® chat ç±»å‹èŠ‚æµï¼šç¾¤ç»„ 3000msï¼Œç§èŠ 1000msï¼ˆå¯é…ç½®ï¼‰
- èŠ‚æµåˆ°æœŸ â†’ editMessageText æ›´æ–°æ¶ˆæ¯
- è¶…è¿‡ 3800 å­—ç¬¦ â†’ åœ¨ä»£ç å—è¾¹ç•Œå¤„å®šç¨¿å½“å‰æ¶ˆæ¯ï¼Œå‘æ–°æ¶ˆæ¯ç»§ç»­ï¼ˆä¿è¯æ¯æ¡æ¶ˆæ¯ Markdown å®Œæ•´æ€§ï¼‰
- Markdown è§£æå¤±è´¥ â†’ é™çº§çº¯æ–‡æœ¬é‡è¯•
- æ”¶åˆ° 429 é”™è¯¯ â†’ æŒ‡æ•°é€€é¿é‡è¯•ï¼ˆåˆå§‹ 1sï¼Œæœ€å¤§ 30sï¼‰
- è¾“å‡ºå®Œæˆ â†’ å‘é€æœ€ç»ˆå®Œæ•´æ¶ˆæ¯

> **å…³äº sendMessageDraft**ï¼šBot API 9.3 çš„ `sendMessageDraft` ä»…æ”¯æŒç§èŠï¼Œä¸æ”¯æŒç¾¤ç»„ Topicã€‚å½“å‰ç»Ÿä¸€ä½¿ç”¨ editMessage æ–¹æ¡ˆã€‚å¦‚æœªæ¥ API æ‰©å±•åˆ°ç¾¤ç»„ï¼Œå¯ä½œä¸º P2 å¢å¼ºå¼•å…¥ã€‚

## æ„å»ºä¸è¿è¡Œ

```bash
# æ„å»º
make build    # â†’ ./bin/tgmux

# è¿è¡Œ
tgmux                                # ä½¿ç”¨é»˜è®¤é…ç½® ~/.tgmux/config.yaml
tgmux -c /path/to/config.yaml        # æŒ‡å®šé…ç½®æ–‡ä»¶
tgmux --web                          # å¯ç”¨ Web UI
tgmux --web --web-port 9090          # å¯ç”¨ Web UI å¹¶æŒ‡å®šç«¯å£

# å¼€å‘
make dev      # go run with -race
make lint     # golangci-lint
make test     # go test ./...
```

**CLI å‚æ•°ä¼˜å…ˆçº§**: å‘½ä»¤è¡Œå‚æ•° > ç¯å¢ƒå˜é‡ > é…ç½®æ–‡ä»¶ > é»˜è®¤å€¼

## éç›®æ ‡

- ä¸åš Telegram Mini Appï¼ˆå¤æ‚åº¦é«˜ï¼Œéœ€è¦ HTTPSï¼‰
- ä¸åš Agent SDK é›†æˆï¼ˆtmux æ¡¥æ¥ä¿æŒä¼šè¯æŒä¹…æ€§å’Œå®Œæ•´ä¸Šä¸‹æ–‡ï¼Œè¿™æ˜¯ headless æ¨¡å¼åšä¸åˆ°çš„ï¼‰
- ä¸åšæ•°æ®åº“ï¼ˆJSON æ–‡ä»¶ + å†…å­˜ RWMutex è¶³çŸ£ï¼‰
- ä¸åšå¤šæœºéƒ¨ç½²ï¼ˆå•æœºå·¥å…·ï¼‰
- ä¸åšè‡ªåŠ¨æ›´æ–°
- ä¸åšåç«¯èƒ½åŠ›æŠ½è±¡ï¼ˆå„åç«¯å·®å¼‚å¤§ï¼Œç»Ÿä¸€æ¥å£ä»…é™ tmux å±‚é¢çš„è¾“å…¥/è¾“å‡ºï¼‰

## Graceful Shutdown

è¿›ç¨‹é€€å‡ºæ—¶æŒ‰é¡ºåºæ‰§è¡Œï¼š
1. åœæ­¢æ¥æ”¶æ–° Telegram æ¶ˆæ¯ï¼ˆåœæ­¢ pollingï¼‰
2. ç­‰å¾…è¿›è¡Œä¸­çš„ send-keys å®Œæˆï¼ˆdrain per-window channelï¼‰
3. å…³é—­æ‰€æœ‰ fsnotify watcher
4. ä¿å­˜æœ€ç»ˆçŠ¶æ€åˆ° state.json
5. tmux çª—å£ä¿ç•™ä¸é”€æ¯ï¼ˆç”¨æˆ·å¯æ‰‹åŠ¨ attach ç»§ç»­ä½¿ç”¨ï¼‰
